# –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### üö´ –ó–∞–ø—Ä–µ—Ç –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤**:
   - ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω—ã: `png`, `jpg`, `jpeg`, `gif`, `bmp`, `tiff`, `webp`, `ico`, `svg`
   - ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω—ã: `pdf`, `docx`, `doc`, `txt`

2. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**:
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: `screenshot`, `—Å–∫—Ä–∏–Ω—à–æ—Ç`, `screen`, `—ç–∫—Ä–∞–Ω`, `capture`, `–∑–∞—Ö–≤–∞—Ç`
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–∞—Ç: `screenshot_2024-01-01`, `screen_20240101`
   - –†—É—Å—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã: `—Å–∫—Ä–∏–Ω—à–æ—Ç_2024-01-01`, `—Ñ–æ—Ç–æ_20240101`

3. **–ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME-—Ç–∏–ø–æ–≤ —á–µ—Ä–µ–∑ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
   - –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–≤)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

4. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞—Ö–≤–∞—Ç–∞ —ç–∫—Ä–∞–Ω–∞**:
   - Snipping Tool, Snagit, Greenshot, Lightshot
   - PicPick, FastStone Capture, ShareX
   - Bandicam, OBS Studio –∏ –¥—Ä—É–≥–∏–µ

### üìè –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: **50 MB** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### üîç –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

1. **–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**:
   - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
   - –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
   - MIME-—Ç–∏–ø

2. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**:
   - –ê–Ω–∞–ª–∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º
   - –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞—Ö–≤–∞—Ç–∞ —ç–∫—Ä–∞–Ω–∞

3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º**:
   - –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–∞–∑–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
ALLOWED_FILE_EXTENSIONS=pdf,docx,doc,txt

# –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
FORBIDDEN_FILE_EXTENSIONS=png,jpg,jpeg,gif,bmp,tiff,webp,ico,svg,psd,ai,sketch

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (MB)
MAX_FILE_SIZE_MB=50

# –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
ENABLE_CONTENT_VALIDATION=true
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞

```env
# –¢–æ–ª—å–∫–æ PDF –∏ DOCX
ALLOWED_FILE_EXTENSIONS=pdf,docx

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤
FORBIDDEN_FILE_EXTENSIONS=png,jpg,jpeg,gif,bmp,tiff,webp,ico,svg,psd,ai,sketch,exe,zip,rar,7z

# –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
MAX_FILE_SIZE_MB=25

# –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
ENABLE_CONTENT_VALIDATION=true
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **INFO**: –£—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- **WARNING**: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏
- **ERROR**: –û—à–∏–±–∫–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```
‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

–ü—Ä–∏—á–∏–Ω—ã:
‚Ä¢ PDF: File appears to be a screenshot or image. Details: Filename pattern: screenshot_2024
‚Ä¢ DOCX: File too large (max 50MB)
```

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```
WARNING: File safety validation failed for instructions/1c/screen_capture.pdf: File appears to be a screenshot or image. Details: Filename pattern: screen_capture, Metadata pattern: created by screenshot tool
INFO: File validation passed for instructions/1c/ar2.pdf: File validation passed
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ö–æ–¥–∞

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ò–º—è —Ñ–∞–π–ª–∞ + —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
2. **Fallback –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫**: –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è
4. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞**: –õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–æ–≤—ã–µ —É–≥—Ä–æ–∑—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** —Å–ø–∏—Å–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∞—Ç–∞–∫
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
4. **–û–±—É—á–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
   - `instruction.pdf` - –æ–±—ã—á–Ω—ã–π PDF
   - `manual.docx` - Word –¥–æ–∫—É–º–µ–Ω—Ç
   - `guide.txt` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª

2. **–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
   - `screenshot.png` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - `screen_capture.pdf` - PDF —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º
   - `photo_20240101.jpg` - —Ñ–æ—Ç–æ —Å –¥–∞—Ç–æ–π
   - `screenshot_2024-01-01.pdf` - PDF —Å –∏–º–µ–Ω–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python3 -m py_compile file_validator.py file_server.py handlers/instructions.py

# –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞
python3 -c "
from file_server import validate_instruction_file
with open('test_file.pdf', 'rb') as f:
    content = f.read()
is_valid, reason = validate_instruction_file('test_file.pdf', content)
print(f'Valid: {is_valid}, Reason: {reason}')
"
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –≤–∞–ª–∏–¥–∞—Ü–∏–∏
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
4. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏

- –í—Ä–µ–º—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"File validation failed"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞

2. **"File too large"**
   - –£–≤–µ–ª–∏—á—å—Ç–µ `MAX_FILE_SIZE_MB` –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

3. **"Content validation failed"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (python-magic)
   - –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ `ENABLE_CONTENT_VALIDATION`

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
export LOG_LEVEL=DEBUG

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
python3 -c "
from file_server import validate_instruction_file
with open('suspicious_file.pdf', 'rb') as f:
    content = f.read()
is_valid, reason = validate_instruction_file('suspicious_file.pdf', content)
print(f'Valid: {is_valid}')
print(f'Reason: {reason}')
"
```

## ‚úÖ –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∏ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:

- ‚úÖ **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤** –ø–æ –∏–º–µ–Ω–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- ‚úÖ **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ **–õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –æ—Ç–ª–∞–¥–∫–∞

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!