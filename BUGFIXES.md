# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ BG Survey Platform

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. TypeError: unsupported operand type(s) for +: 'int' and 'InstrumentedList'

**–ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞**: –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (dashboard)
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ —Å–ª–æ–∂–∏—Ç—å `int` –∏ `InstrumentedList` –≤ Jinja2 —à–∞–±–ª–æ–Ω–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤**:
- `app.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `count_responses()` –∏ `count_active_surveys()`
- `templates/dashboard.html` - –∑–∞–º–µ–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π

### 2. jinja2.exceptions.UndefinedError: 'moment' is undefined

**–ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞**: –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (admin)
**–ü—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `moment.js` –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤**:
- `templates/admin.html` - —É–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç moment.js

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥—Å—á–µ—Ç–æ–º –æ—Ç–≤–µ—Ç–æ–≤ –≤ —à–∞–±–ª–æ–Ω–∞—Ö

**–ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞**: –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å SQLAlchemy –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏ –≤ Jinja2
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤**:
- `app.py` - –¥–æ–±–∞–≤–ª–µ–Ω `@app.context_processor`
- –í—Å–µ —à–∞–±–ª–æ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–∞—Ç

**–ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç –≤ —à–∞–±–ª–æ–Ω–∞—Ö
**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞—Ç
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `format_date()` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤**:
- `app.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `format_date()`
- `templates/dashboard.html` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç

## ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `app.py`

```python
@app.context_processor
def utility_processor():
    def count_responses(surveys):
        """–ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Å–ø–∏—Å–∫–∞ –æ–ø—Ä–æ—Å–æ–≤"""
        total = 0
        for survey in surveys:
            if hasattr(survey, 'responses'):
                total += len(survey.responses)
        return total
    
    def count_active_surveys(surveys):
        """–ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ (—Å –æ—Ç–≤–µ—Ç–∞–º–∏)"""
        count = 0
        for survey in surveys:
            if hasattr(survey, 'responses') and len(survey.responses) > 0:
                count += 1
        return count
    
    def format_date(date_obj):
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É –≤ —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥"""
        if date_obj:
            try:
                return date_obj.strftime('%d.%m')
            except:
                return str(date_obj)
        return '-'
    
    return {
        'count_responses': count_responses,
        'count_active_surveys': count_active_surveys,
        'format_date': format_date
    }
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —à–∞–±–ª–æ–Ω–∞—Ö

#### `templates/dashboard.html`
- –ó–∞–º–µ–Ω–µ–Ω `surveys|sum(attribute='responses')` –Ω–∞ `{{ count_responses(surveys) }}`
- –ó–∞–º–µ–Ω–µ–Ω `surveys|selectattr('responses')|list|length` –Ω–∞ `{{ count_active_surveys(surveys) }}`
- –£–ø—Ä–æ—â–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é `{{ format_date(latest_survey.created_at) }}`

#### `templates/admin.html`
- –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `moment.js`
- –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç "–°–µ–π—á–∞—Å"

## üîß –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–¥–æ–±–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –±—É–¥—É—â–µ–º

### 1. –†–∞–±–æ—Ç–∞ —Å SQLAlchemy –≤ Jinja2
- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** —Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ `|sum(attribute='responses')`
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ** –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ** —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ** –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ** `hasattr()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–æ–¥–æ–≤
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ** –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### 3. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ** —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `@app.context_processor` –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ —à–∞–±–ª–æ–Ω–∞—Ö
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–ø–µ—Ä—å:
1. ‚úÖ **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. ‚úÖ **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–æ–≤** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
4. ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. ‚úÖ **–î–∞—Ç—ã** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
5. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –æ–ø—Ä–æ—Å

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Flask-SQLAlchemy**: https://flask-sqlalchemy.palletsprojects.com/
- **Jinja2**: https://jinja.palletsprojects.com/
- **SQLAlchemy –æ—Ç–Ω–æ—à–µ–Ω–∏—è**: https://docs.sqlalchemy.org/en/14/orm/relationships.html

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑:
- –û—à–∏–±–æ–∫ —Ç–∏–ø–∞ `TypeError` —Å `InstrumentedList`
- –û—à–∏–±–æ–∫ `UndefinedError` —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –ü—Ä–æ–±–ª–µ–º —Å –ø–æ–¥—Å—á–µ—Ç–æ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö

**BG Survey Platform** –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

---

*–í–µ—Ä—Å–∏—è 1.0.1 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 2024*